@inject NavigationManager Navigation
@inject TcgFront.Services.AuthService AuthService
@using Microsoft.AspNetCore.Components.Authorization

<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top px-4 py-3 shadow">
    <div class="container-fluid">

        <div class="d-flex align-items-center">
            <a class="navbar-brand fw-bold" href="/">TCG MARKET</a>
            <div class="navbar-nav ms-4 d-none d-md-flex">
                <NavLink class="nav-link" href="/" Match="NavLinkMatch.All">Inicio</NavLink>
                <NavLink class="nav-link" href="/market">Mercado</NavLink>
                
                <AuthorizeView>
                    <Authorized>
                        <NavLink class="nav-link" href="/collection">Mi Colección</NavLink>
                    </Authorized>
                </AuthorizeView>
            </div>
        </div>

        <AuthorizeView>
            
            <NotAuthorized>
                <div class="d-flex align-items-center gap-2">
                    <NavLink class="btn btn-outline-light btn-sm" href="user/login">Iniciar Sesión</NavLink>
                    <NavLink class="btn btn-light btn-sm" href="user/register">Registrarse</NavLink>
                </div>
            </NotAuthorized>

            <Authorized>
                <div class="d-flex align-items-center user-dropdown-container">
                    <div class="text-white d-flex align-items-center gap-2 cursor-pointer">
                        <div class="text-end d-none d-sm-block lh-1">
                            <span class="d-block small text-muted">Hola,</span>
                            <span class="fw-bold">@context.User.Identity?.Name</span>
                        </div>
                        <i class="bi bi-person-circle fs-3"></i>
                    </div>

                    <div class="user-dropdown-menu shadow rounded">
                        <div class="p-3 text-center border-bottom bg-light">
                            <small class="text-muted fw-bold">Mi Cuenta</small>
                        </div>
                        <NavLink class="dropdown-item py-2" href="profile">
                            <i class="bi bi-person-badge me-2"></i> Ver Perfil
                        </NavLink>
                        <div class="dropdown-divider m-0"></div>
                        <button class="dropdown-item text-danger py-2" @onclick="HandleLogout">
                            <i class="bi bi-box-arrow-right me-2"></i> Cerrar Sesión
                        </button>
                    </div>
                </div>
            </Authorized>

        </AuthorizeView>

    </div>
</nav>

@code {
    private async Task HandleLogout()
    {
        // Redirect to login page and clear auth state
        await AuthService.Logout();
        Navigation.NavigateTo("/login", true);
    }
}